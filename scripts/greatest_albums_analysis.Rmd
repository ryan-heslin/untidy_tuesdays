---
title: "Notes"
author: "Ryan Heslin"
date: "`r Sys.Date()`"
output: pdf_document
---

 <!-- Standard custom LaTeX commands -->
\newcommand{\abcd}{\begin{bmatrix}a&b\\
c&d\end{bmatrix}}
\newcommand{\m}[1]{\begin{bmatrix}#1\end{bmatrix}}

\newcommand{\vect}[1]{\begin{pmatrix}#1\end{pmatrix}}

\newcommand{\meq}[1]{\begin{split}#1\end{split}}

\newcommand{\bym}[1]{#1\times{m}}

\newcommand{\nby}[1]{n\times{#1}}

\newcommand{\subsp}[2]{\Bigg\{\begin{bmatrix}#1\end{bmatrix}:#2\Bigg\}}

\newcommand{\proj}[2]{\text{proj}_#1(#2)}

\newcommand{\refl}[2]{\text{refl}_#1(#2)}

\newcommand{\sumn}{\sum_{i=1}^n}

<!-- % 1: term 1 -->
<!-- % 2: subscript 1 -->
<!-- % 3: term 2 -->
<!-- % 4: subscript 2 -->
<!-- % 5. operation -->
\newcommand{\dotsn}[5]{#1_{1}#3_{1}#5{#1}_{2}#3_{2}{#5}\dots{#5}#1_{#2}#3_{#4}}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "", fig.pos = "", warning = FALSE,
                      tidy = TRUE, fig.align = "center")

library(tidyverse)
library(rlang)
```


```{r}
albums <- text_raw %>% 
  map(bind_cols) %>% 
  bind_rows() %>%
  separate(artist_album,
           sep = ",\\s|\\s,|'\\s'", #special cases
           into = c("artist", "album")) %>% 
  separate(
    label_year,
    sep = ",\\s",
    into = c("label", "year"),
    convert = TRUE
  ) %>% 
  mutate(rank = nrow(.):1,
         across(where(is.character), ~str_remove_all(.x, "\\\"|^\\'|\\'$")))
  
```

A few albums didn't have years included, so I recode them.
```{r}
recodes <- exprs(album == "Tumbleweed Connection" ~ 1970,
                 album == "CrazySexyCool" ~ 1994,
                 album == "The Blueprint" ~ 2001,
                 TRUE ~ year)
albums %>% mutate(year = case_when(!!!recodes))

```
Luckily, rank is a unique key, saving me a potentially nasty fuzzy join.
```{r}
genres <- genres %>% select(number, genre, subgenre) %>%
  mutate(genre = str_replace_all(
    genre,
    c(
      "\\s(/|\\\\)\\s" = ", ",
      ",J" = ", ",
      "Folk, World, & Country" = "Folk"
    )
  ))
albums <-
  left_join(albums,
            genres,
            by = c(rank = "number"))
```

# Lasso Regression

```{r}
library(tidytext)

custom_stops = c("song", "songs", "album", "albums", "music", "band", "record", "track" )

by_word <- albums %>% 
  unnest_tokens(word, description) %>% 
  filter(!word %in% c(stop_words$word, custom_stops))

```

I elect to break some compound genres like "Funk /Soul" into individual pieces.
```{r}
by_word <- by_word %>% 
  separate_rows(genre, sep = ",\\s")

```


```{r}
count(by_word, genre)
```

```{r}
count(by_word, word, genre, sort = TRUE)
```
